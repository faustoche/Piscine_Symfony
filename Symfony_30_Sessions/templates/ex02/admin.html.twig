{% extends 'ex01/base.html.twig' %}

{% block title %}Admin{% endblock %}

{% block body %}
    <div class="card" style="max-width: 800px;"> {# On l'élargit un peu pour le tableau #}
        <h1>User admin</h1>

        {# Affichage des messages flash (succès ou erreur) #}
        {% for message in app.flashes('error') %}
            <div class="alert" style="background-color: #f8d7da; color: #721c24;">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('success') %}
            <div class="alert" style="background-color: #d4edda; color: #155724;">{{ message }}</div>
        {% endfor %}

        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr style="background-color: #f3d7e4ff; text-align: left;">
                    <th style="padding: 10px;">ID</th>
                    <th style="padding: 10px;">Username</th>
                    <th style="padding: 10px;">Roles</th>
                    <th style="padding: 10px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">{{ user.id }}</td>
                        <td style="padding: 10px; font-weight: bold;">{{ user.username }}</td>
                        <td style="padding: 10px;">
                            {% for role in user.roles %}
                                <span style="font-size: 0.8em; background: #eee; padding: 2px 5px; border-radius: 3px;">{{ role }}</span>
                            {% endfor %}
                        </td>
                        <td style="padding: 10px;">
                            {# On cache le bouton supprimer si c'est l'utilisateur courant #}
                            {% if user != app.user %}
                                <a href="{{ path('app_admin_delete_user', {'id': user.id}) }}" 
                                   class="btn" 
                                   style="background-color: #dc3545; padding: 5px 10px; font-size: 0.9em; margin: 0;"
                                   onclick="return confirm('Are you sure?')">
                                   Delete
                                </a>
                            {% else %}
                                <span style="color: #ccc;">(You)</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="links">
            <a href="{{ path('app_homepage') }}">Back to Homepage</a>
        </div>
    </div>
{% endblock %}